# LanLink 快速开始指南

## 📦 安装

### 方式一：下载预编译版本（推荐）

1. 从 [Releases](https://github.com/618lf/lanlink/releases) 下载对应平台的版本
2. 解压到任意目录
3. 跳转到"运行"章节

### 方式二：从源码编译

#### 前置要求
- Go 1.23 或更高版本

#### 编译步骤

**Windows:**
```batch
git clone https://github.com/618lf/lanlink.git
cd lanlink
build.bat
```

**Linux/Mac:**
```bash
git clone https://github.com/618lf/lanlink.git
cd lanlink
chmod +x build.sh
./build.sh
```

编译产物在 `dist/` 目录下。

## 🚀 运行

### Windows

1. **右键点击** `lanlink.exe`
2. 选择 **"以管理员身份运行"**

或者在管理员 PowerShell 中：
```powershell
.\lanlink.exe
```

### Linux

```bash
sudo ./lanlink
```

### macOS

```bash
sudo ./lanlink
```

首次运行可能需要在"系统偏好设置 > 安全性与隐私"中允许运行。

## 📝 配置（可选）

首次运行使用默认配置即可。如需自定义，在程序目录创建 `config.json`：

```json
{
  "deviceName": "mypc",
  "domainSuffix": "local",
  "multicastAddr": "239.255.0.1",
  "multicastPort": 9527,
  "heartbeatIntervalSec": 10,
  "offlineTimeoutSec": 30,
  "logLevel": "info"
}
```

### 配置说明

| 参数 | 说明 | 默认值 |
|------|------|--------|
| deviceName | 设备名称，为空则使用主机名 | (主机名) |
| domainSuffix | 域名后缀 | local |
| multicastAddr | 组播地址 | 239.255.0.1 |
| multicastPort | 组播端口 | 9527 |
| heartbeatIntervalSec | 心跳间隔（秒） | 10 |
| offlineTimeoutSec | 离线超时（秒） | 30 |
| logLevel | 日志级别 | info |

## ✅ 验证运行

### 1. 查看日志

程序会在同目录生成 `lanlink.log`，正常运行应看到：

```
[2024-11-27 10:30:00] [INFO] === LanLink 启动 ===
[2024-11-27 10:30:00] [INFO] 设备名称: mypc
[2024-11-27 10:30:00] [INFO] Hosts文件初始化完成
[2024-11-27 10:30:00] [INFO] 本机信息: DeviceID=mac-xx:xx:xx:xx:xx:xx, IP=192.168.1.100, Domain=mypc.local
[2024-11-27 10:30:00] [INFO] 组播监听已启动: 239.255.0.1:9527
[2024-11-27 10:30:00] [INFO] LanLink 运行中，按 Ctrl+C 退出
```

### 2. 查看 Hosts 文件

**Windows:** `C:\Windows\System32\drivers\etc\hosts`  
**Linux/Mac:** `/etc/hosts`

应该看到类似内容：

```text
# === LanLink Managed Begin ===
# === LanLink Managed End ===
```

### 3. 多台设备测试

在另一台设备上也启动 LanLink，稍等片刻后：

**设备A的日志：**
```
[2024-11-27 10:31:00] [INFO] 节点上线: device-b (device-b.local -> 192.168.1.101)
[2024-11-27 10:31:00] [INFO] 已更新hosts: device-b.local -> 192.168.1.101
```

**设备A的Hosts文件：**
```text
# === LanLink Managed Begin ===
192.168.1.101  device-b.local  # LanLink
# === LanLink Managed End ===
```

### 4. 测试连接

在任一设备上执行：

```bash
# Ping 测试
ping device-b.local

# 或者
ping mypc.local
```

成功！🎉

## 🔧 常见问题

### Q: 提示"无权限修改hosts文件"

**A:** 必须以管理员/root身份运行程序。

### Q: 无法发现其他设备

**A:** 检查：
1. 防火墙是否放行 UDP 9527 端口
2. 设备是否在同一局域网
3. 路由器是否支持组播

### Q: 如何关闭程序？

**A:** 在程序运行窗口按 `Ctrl+C`，程序会优雅退出并发送离线通知。

### Q: 域名被自动重命名了？

**A:** 说明局域网内有设备名冲突，修改 `config.json` 中的 `deviceName` 确保唯一性。

## 🎯 实际应用场景

### 1. 开发环境

不再需要记忆测试服务器的动态IP：

```bash
# 连接开发服务器
ssh dev@dev-server.local

# 访问数据库
mysql -h db-server.local -u root -p

# 访问Web服务
curl http://api-server.local:3000
```

### 2. 家庭网络

给家里的设备取个好记的名字：

```bash
# 访问NAS
http://nas.local:5000

# 连接树莓派
ssh pi@raspberry.local

# 打印机管理
http://printer.local
```

### 3. 办公室

快速访问同事的开发机：

```bash
# 前端开发机
http://frontend-pc.local:3000

# 后端开发机
http://backend-pc.local:8080
```

## 🚀 下一步

- 阅读 [完整文档](../README.md)
- 了解 [工作原理](../docs/需求文档.md)
- 查看 [故障排查指南](../README.md#-故障排查)

---

遇到问题？欢迎提交 [Issue](https://github.com/618lf/lanlink/issues)

